/* =========================
   1. 移动端点击高亮修复
   ========================= */
html, body { -webkit-tap-highlight-color: transparent; }
a, button, [role="button"], .tile, .icon-btn, .mini-btn, .nav a, .avatar-wrap {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  outline: none;
}
a:active, button:active, .tile:active, .icon-btn:active, .mini-btn:active { background-image: none; }
:focus:not(:focus-visible) { outline: none; }
:focus-visible{ outline: 2px solid rgba(0,0,0,.35); outline-offset: 3px; border-radius: 10px; }
::selection{ background: rgba(0,0,0,.12); }
body.no-select .modal-panel, body.no-select .modal-panel *, body.no-select .center-scroll, body.no-select .center-scroll *{
  -webkit-user-select: text; user-select: text;
}

/* =========================
   2. 全局基础布局
   ========================= */
*{ box-sizing: border-box; }
/* 平滑滚动仅对非吸附区域生效 */
html{ scroll-behavior: smooth; }

:root{
  --header-h: 74px;
  --bg: #e6e6e6;
  --card: rgba(255,255,255,0.95);
  --border: rgba(0,0,0,0.08);
  --shadow: 0 14px 36px rgba(0,0,0,0.12);
  --page-bg: linear-gradient(135deg,#eef2ff,#e2e8ff);
  --page-bg-next: linear-gradient(135deg,#eef2ff,#e2e8ff);
  --bg-fade-ms: 1100ms;
  --top-a: #22c55e;
  --top-b: #fb7185;
}

body{ margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif; color: #111; background: var(--bg); }
body::before{ content:""; position: fixed; inset: 0; background: var(--page-bg); z-index: -2; }
body::after{ content:""; position: fixed; inset: 0; background: var(--page-bg-next); opacity: 0; transition: opacity var(--bg-fade-ms) ease; z-index: -1; }
body.bg-fading::after{ opacity: 1; }

/* =========================
   3. 顶部导航 (Topbar)
   ========================= */
.topbar{ position: fixed; top: 0; left: 0; right: 0; background: rgba(255,255,255,0.6); backdrop-filter: blur(10px); z-index: 10; }
.topbar-inner{ max-width: 1020px; margin: 0 auto; padding: 14px 16px; display: flex; align-items: center; gap: 14px; }
.brand{ flex: 1; min-width: 0; }
.name{ font-weight: 800; font-size: 18px; background: linear-gradient(90deg, var(--top-a), var(--top-b)); -webkit-background-clip: text; background-clip: text; color: transparent; }
.tagline{ color:#555; font-size: 12px; margin-top: 2px; }
.nav{ display: flex; gap: 10px; }
.nav a{ text-decoration: none; color:#333; font-size: 14px; padding: 6px 10px; border-radius: 10px; }
.nav a:hover{ background: rgba(0,0,0,0.06); }
.avatar-wrap{ width: 40px; height: 40px; border-radius: 999px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.12); flex: 0 0 auto; }
.avatar{ width: 100%; height: 100%; object-fit: cover; display: block; }
.divider{ height: 1px; background: rgba(0,0,0,0.12); }

/* =========================
   4. 滚动容器 (Snap)
   ========================= */
.snap{ 
  height: 100vh; 
  overflow-y: auto; 
  padding-top: var(--header-h); 
  scroll-padding-top: var(--header-h); 
  
  /* 基础吸附设置 */
  scroll-snap-type: y proximity; 
  
  /* 手机端防穿透 */
  overscroll-behavior-y: none;
}

/* 弹窗打开时锁死一级页面 */
body.modal-open #snap{ overflow: hidden !important; }

/* ✅ 核心修复：将强制停止 (stop always) 加在子元素上 */
.section{ 
  scroll-snap-align: start; 
  /* 关键属性：强制每次滚动只停在下一页，禁止飞跃 */
  scroll-snap-stop: always; 
  
  min-height: calc(100vh - var(--header-h)); 
  padding: 28px 16px; 
  display: flex; 
  align-items: center; 
}

.container{ max-width: 1020px; margin: 0 auto; width: 100%; }

/* =========================
   5. 卡片与首页 (Hero)
   ========================= */
.card{ background: var(--card); border: 1px solid var(--border); border-radius: 18px; box-shadow: var(--shadow); padding: 28px 24px; }
.hero h1{ margin: 0 0 10px; font-size: 34px; }
h2{ margin: 0 0 12px; font-size: 22px; }
p{ margin: 10px 0 0; line-height: 1.75; }
.lead{ font-size: 16px; color:#222; }
.muted{ color:#666; font-size: 13px; }

.hero-brand { display: flex; align-items: center; gap: 14px; margin-bottom: 20px; }
.hero-title { display: flex; align-items: center; gap: 10px; margin: 0; font-size: 2.5rem; font-weight: 800; }
.hero-name { background: linear-gradient(135deg, #2563eb, #db2777); -webkit-background-clip: text; background-clip: text; color: transparent; }

/* 亮条结构 */
.gpt-mark { display: flex; gap: 4px; height: 28px; align-items: center; }
.strip { width: 6px; height: 100%; border-radius: 4px; opacity: 0.2; transform: scaleY(0.3); transition: all 0.4s; background: #333; }
.s1 { background: #10a37f; } 
.s2 { background: #ef4146; } 
.s3 { background: #f4a261; } 
.s4 { background: #a855f7; }

/* 亮条动画 */
.anim-active .gpt-mark .strip,
body.hero-anim .gpt-mark .strip {
  animation: strip-pop 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}
.anim-active .gpt-mark .strip.s1, body.hero-anim .gpt-mark .strip.s1 { animation-delay: 0.1s; }
.anim-active .gpt-mark .strip.s2, body.hero-anim .gpt-mark .strip.s2 { animation-delay: 0.2s; }
.anim-active .gpt-mark .strip.s3, body.hero-anim .gpt-mark .strip.s3 { animation-delay: 0.3s; }
.anim-active .gpt-mark .strip.s4, body.hero-anim .gpt-mark .strip.s4 { animation-delay: 0.4s; }

@keyframes strip-pop {
  0% { opacity: 0; transform: scaleY(0); }
  100% { opacity: 1; transform: scaleY(1); }
}

/* =========================
   6. 爱好板块 (Hobbies)
   ========================= */
.grid2{ margin-top: 16px; display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.tile{ appearance: none; border: 1px solid var(--border); background: #fff; border-radius: 16px; padding: 18px 16px; text-align: left; cursor: pointer; box-shadow: 0 10px 24px rgba(0,0,0,0.08); transition: transform 180ms ease, box-shadow 180ms ease; touch-action: manipulation; }
.tile:hover{ transform: translateY(-2px); box-shadow: 0 14px 30px rgba(0,0,0,0.12); }
.tile-title{ font-size: 18px; font-weight: 800; margin-bottom: 6px; }
.tile-desc{ font-size: 13px; color:#666; }

/* =========================
   7. 笔谈板块 (Notes)
   ========================= */
.tri{ margin-top: 18px; display: grid; grid-template-columns: 1fr 1.4fr 1fr; gap: 14px; align-items: center; }
.side{ background: rgba(255,255,255,0.9); border: 1px solid var(--border); border-radius: 16px; padding: 16px 14px; box-shadow: 0 10px 24px rgba(0,0,0,0.08); min-height: 280px; }
.side-title{ font-weight: 800; margin-bottom: 10px; }

/* 核心：笔谈区适配 */
.center-scroll{ 
  background: rgba(255,255,255,0.95); 
  border: 1px solid var(--border); 
  border-radius: 16px; 
  box-shadow: 0 12px 30px rgba(0,0,0,0.10); 
  min-height: 360px; 
  max-height: 62vh; 
  overflow: auto; 
  
  /* ✅ 保持内容区丝滑 */
  -webkit-overflow-scrolling: touch; 
  
  /* ✅ 滚动边界锁：内容滑到底时，不触发外层翻页 */
  overscroll-behavior: contain; 
  position: relative; 
}

.center-title{ position: sticky; top: 0; background: rgba(255,255,255,0.98); border-bottom: 1px solid rgba(0,0,0,0.08); padding: 14px 14px; font-weight: 900; z-index: 1; display: flex; justify-content: space-between; align-items: center; }
.center-body{ padding: 14px 14px 18px; }
.center-body p { margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
.center-body a { color: #2563eb; font-weight: 500; }
.mini-btn{ padding: 4px 10px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.12); background: #fff; cursor: pointer; font-size: 12px; }

/* =========================
   8. 弹窗与画廊 (Modal & Gallery)
   ========================= */
.modal{ position: fixed; inset: 0; display: none; z-index: 50; }
.modal.open{ display: flex; align-items: center; justify-content: center; }
.modal-backdrop{ position: absolute; inset: 0; background: rgba(0,0,0,0.45); touch-action: none; }
.modal-panel{ position: relative; width: min(860px, calc(100vw - 32px)); max-height: min(78vh, 720px); overflow: auto; background: #fff; border-radius: 18px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 18px 60px rgba(0,0,0,0.25); display: flex; flex-direction: column; }
.modal-head{ position: sticky; top: 0; background: rgba(255,255,255,0.98); border-bottom: 1px solid rgba(0,0,0,0.10); display: flex; align-items: center; justify-content: space-between; padding: 14px 14px; z-index: 2; }
.modal-title{ font-weight: 900; }
.icon-btn{ width: 34px; height: 34px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.12); background: #fff; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
.modal-body{ padding: 14px 16px 18px; flex: 1; overflow-y: auto; }

.gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 16px; margin-top: 20px; }
.photo-card { aspect-ratio: 1; background: #f3f4f6; border-radius: 12px; overflow: hidden; cursor: zoom-in; position: relative; transition: transform 0.2s; }
.photo-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
.photo-card img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
.photo-card:hover img { transform: scale(1.05); }

/* Lightbox */
.lightbox .modal-panel { background: transparent; box-shadow: none; border: none; max-width: 100%; height: 100%; border-radius: 0; }
.lightbox .modal-body { display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 0; background: rgba(0,0,0,0.9); }
.lightbox-img { max-width: 100%; max-height: 80vh; object-fit: contain; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
.lightbox-meta { margin-top: 20px; text-align: center; color: rgba(255,255,255,0.9); }
.lightbox-title { font-size: 1.1rem; font-weight: 600; }
.lightbox-date { font-size: 0.85rem; opacity: 0.7; margin-top: 4px; }
.lightbox-desc { margin-top: 10px; font-size: 13px; color: #eee; }
.lightbox .modal-head { background: transparent; border: none; position: absolute; top: 0; right: 0; width: 100%; color: #fff; }
.lightbox .modal-title { display: none; }
.lightbox .icon-btn { background: rgba(255,255,255,0.1); color: #fff; border: none; }

/* =========================
   9. 联系板块 & 开屏
   ========================= */
.email-list{ margin-top: 12px; display: flex; flex-wrap: wrap; gap: 10px; }
.email{ display: inline-block; padding: 10px 12px; border-radius: 12px; background: #111; color: #fff; font-size: 13px; }

.intro-splash { position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; align-items: center; justify-content: center; }
.intro-splash.fade-out { animation: splashFadeOut 0.6s ease-in-out forwards; }
.intro-content { text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.intro-hello { font-size: 10rem; font-weight: 900; line-height: 1; letter-spacing: -4px; color: #000; opacity: 0; transform: translateY(40px); animation: textSlideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.2s forwards; }
.intro-name { font-size: 2rem; font-weight: 600; color: #666; margin-top: 15px; opacity: 0; transform: translateY(20px); animation: textSlideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.5s forwards; letter-spacing: 2px; }
@keyframes textSlideUp { to { opacity: 1; transform: translateY(0); } }
@keyframes splashFadeOut { to { opacity: 0; visibility: hidden; } }

/* =========================
   10. 响应式适配
   ========================= */
@media (max-width: 720px){
  /* ✅ 移动端专属阻尼增强 */
  .snap { 
    /* mandatory 更加强制，必须吸附 */
    scroll-snap-type: y mandatory; 
    
    /* 禁用容器级别的惯性，让翻页更“重”，手指一停页面就停 */
    /* 注意：内容区 .center-scroll 依然保留惯性，体验不冲突 */
    -webkit-overflow-scrolling: auto; 
  }
  
  .nav{ display:none; }
  .grid2{ grid-template-columns: 1fr; }
  .tri{ grid-template-columns: 1fr; height: auto; }
  
  /* 笔谈区在手机上限制高度，防止占满全屏导致无法划走 */
  .center-scroll{ max-height: 56vh; }
  
  .gallery{ grid-template-columns: 1fr; }
  .intro-hello { font-size: 5rem; letter-spacing: -2px; }
  .intro-name { font-size: 1.5rem; }
}
#seasonFx { position: fixed; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 6; opacity: 0.9; }
@media (prefers-reduced-motion: reduce){ #seasonFx{ display: none; } }

/* =========================
   11. Gesture Tree Overlay (UI Styles)
   ========================= */
#gesture-overlay {
  position: fixed; inset: 0; z-index: 9999; background: #050505;
  font-family: 'Times New Roman', serif; overflow: hidden;
}
#canvas-container { width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; z-index: 1; }

#video-input {
  position: absolute; bottom: 20px; right: 20px; width: 160px; height: 120px;
  z-index: 2; border-radius: 10px; border: 2px solid #d4af37; opacity: 0.7; transform: scaleX(-1);
  transition: opacity 0.5s;
}
#video-input.hidden { opacity: 0; pointer-events: none; }

#ui-layer {
  position: absolute; top: 20px; left: 20px; z-index: 10; color: #d4af37; pointer-events: none;
  width: 300px;
}
#ui-layer h1 {
  margin: 0; font-weight: 100; font-size: 2rem; letter-spacing: 5px; text-transform: uppercase;
  text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
}
#status-text { font-size: 0.9rem; margin-top: 10px; color: #aaa; }

#controls { pointer-events: auto; margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }

#controls button {
  background: rgba(212, 175, 55, 0.1); border: 1px solid #d4af37; color: #d4af37;
  padding: 8px 16px; cursor: pointer; font-family: inherit; letter-spacing: 1px;
  transition: all 0.3s ease; text-transform: uppercase; font-size: 0.8rem; border-radius: 4px;
}
#controls button:hover { background: #d4af37; color: #000; box-shadow: 0 0 15px #d4af37; }

#mouse-controls { display: flex; }

#gesture-loading {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  color: #d4af37; z-index: 20; letter-spacing: 3px; pointer-events: none;
}